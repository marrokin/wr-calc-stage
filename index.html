<!DOCTYPE html> 

<html>
<head>
<title>World Rugby World Rankings calculator</title>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//ajax.aspnetcdn.com/ajax/knockout/knockout-3.3.0.js"></script>
<link href="styles/wr-calc.css" type="text/css" rel="stylesheet">
<script src="scripts/models/ViewModel.js" type="text/javascript" ></script>
<script src="scripts/models/RankingViewModel.js" type="text/javascript" ></script>
<script src="scripts/models/FixtureViewModel.js" type="text/javascript" ></script>
<script src="scripts/models/PickerViewModel.js" type="text/javascript" ></script>
</head>
<body data-bind="attr: { class: $data.teamPicker() ? 'masked' : '' }">
    <div class="teamSelect" data-bind="with: teamPicker">
        <div class="mask" data-bind="click: function () { $data.cancelled(); }"></div>
        <div class="teams">
            <form data-bind="submit: teamSelectedIfOne">
                <input id="teamSelectText" type="text" data-bind="textInput: selectTeamFilter"></input>
            </form>
            <ol data-bind="foreach: filteredTeams">
                <li>
                    <button class="team" data-bind="text: name, click: function () { $parent.teamSelected($data); }"></button>
                </li>
            </ol>
        </div>
    </div>

    <div id="rankings">
        <div data-bind="if: shownRankings">
            <input type="radio" name="rankings" value="original" data-bind="checked: shownRankings">Original
            <input type="radio" name="rankings" value="calculated" data-bind="checked: shownRankings">Calculated
        </div>

        <!-- ko ifnot: shownRankings -->
        <h4>
            Loading rankings from <a href="http://www.worldrugby.org/rankings/mru?lang=en">World Rugby</a>
        </h4>
        <!-- /ko -->

        <div data-bind="if: ($data.shownRankings() === 'original' && $data.baseRankings())">
            <h4><a href="http://www.worldrugby.org/rankings/mru">World Rugby</a> rankings as of <span data-bind="text: originalDate"></span></h4>
            <table>
                <thead>
                    <tr style="text-align: left;"><th>#</th><th /><th>Team</th><th>Points</th><th /></tr>
                </thead>
                <tbody data-bind="foreach: baseRankings">
                    <tr class="ranking">
                        <td data-bind="text: pos"></td>
                        <td data-bind="html: previousPosDisplay"></td>
                        <td data-bind="text: team.name"></td>
                        <td data-bind="text: ptsDisplay"></td>
                        <td data-bind="html: ptsDiffDisplay"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div data-bind="if: ($data.shownRankings() === 'calculated' && $data.projectedRankings())">
            <h4>Rankings from <span data-bind="text: originalDate"></span> after applying displayed fixtures.</h4>
            <table>
                <thead>
                    <tr style="text-align: left;"><th>#</th><th /><th>Team</th><th>Points</th><th /></tr>
                </thead>
                <tbody data-bind="foreach: projectedRankings">
                    <tr class="ranking">
                        <td data-bind="text: pos"></td>
                        <td data-bind="html: previousPosDisplay"></td>
                        <td data-bind="text: team.name"></td>
                        <td data-bind="text: ptsDisplay"></td>
                        <td data-bind="html: ptsDiffDisplay"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="fixtures">
        <h4>Fixtures</h4>
        <div>
            <button onclick='addFixture(true);'>Add row</button>
        </div>
        <table>
            <thead>
                <tr><th>Home team</th><th colspan='2'>Score</th><th>Away team</th><th title='No Home Advantage'>NHA</th><th title='Is Rugby World Cup match'>RWC</th></tr>
            </thead>
            <tbody data-bind="foreach: fixtures">
                <tr class="fixture" data-bind="style: { 'background-color' : ($data.isValid() ? '#dfd' : '#fdd') }">
                    <td>
                        <button class="team" data-bind="text: $parent.rankingsById()[$data.homeId()] ? $parent.rankingsById()[$data.homeId()].team.name : 'Home...', click: function () { $parent.selectTeam($data, true); }"></button>
                    </td>
                    <td><input type="number" min="0" data-bind="value: homeScore" /></td>
                    <td><input type="number" min="0" data-bind="value: awayScore" /></td>
                    <td>
                        <button class="team" data-bind="text: $parent.rankingsById()[$data.awayId()] ? $parent.rankingsById()[$data.awayId()].team.name : 'Away...', click: function () { $parent.selectTeam($data, false); }"></button>
                    </td>
                    <td><input type="checkbox" data-bind="checked: noHome" /></td>
                    <td><input type="checkbox" data-bind="checked: isRwc" /></td>
                    <td><button data-bind="click: function () { $parent.fixtures.remove($data); }">x</button></td>
                </tr>
            </tbody>
        </table>
        <div>
            <button onclick='addFixture();'>Add row</button>
        </div>
        <small>
            Rankings and ranking algorithm are the property of World Rugby.
            <br />
            See <a href="https://github.com/rawling/wr-calc/">GitHub</a> for source, contributors and license.
        </small>
    </div>
    <script src="scripts/wr-calc.js" type="text/javascript" ></script>
</body>
</html>